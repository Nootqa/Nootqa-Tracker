<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Qur'an Tracker – Hifdh & Révision</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- PWA -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#a1897b">

  <style>
    * {
      box-sizing: border-box;
    }

    :root {
      /* Thème Mocha par défaut */
      --bg: #efe8e1;
      --card: #ffffff;
      --primary: #a1897b;
      --primary-soft: #dac8bc;
      --border-soft: #d1c0b4;
      --text-main: #2b2320;
      --text-soft: #6e625a;
      --text-muted: #9b8f86;

      --mem-color: #a1897b;  /* mémorisation */
      --rev-color: #6f7b70;  /* révision */
      --rev-bg: #f3ebe4;     /* fond beige clair révision */
    }

    /* Thème Rose nude */
    body[data-theme="rose"] {
      --bg: #f8edef;
      --card: #ffffff;
      --primary: #c88ca8;
      --primary-soft: #f4d6e4;
      --border-soft: #f0c8dd;
      --text-main: #2b2320;
      --text-soft: #7b5a6c;
      --text-muted: #b08a9d;

      --mem-color: #c88ca8;
      --rev-color: #7a8b92;
      --rev-bg: #f2e8f0;
    }

    body {
      margin: 0;
      padding: 16px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #f6efe8, var(--bg));
      color: var(--text-main);
    }

    /* On cache l’app tant que le code n’est pas activé */
    .app {
      max-width: 840px;
      margin: 0 auto 40px auto;
      display: none;
    }

    .bismillah {
      text-align: center;
      font-size: 1.35rem;
      margin: 10px 0 8px 0;
      color: #8d6f5f;
      font-weight: 600;
    }

    .top-bar {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 6px;
    }

    .brand {
      font-size: 0.78rem;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      color: var(--text-muted);
      white-space: nowrap;
      margin-top: 6px;
    }

    .right-controls {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
      font-size: 0.8rem;
    }

    .control-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .control-label {
      color: var(--text-muted);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      white-space: nowrap;
    }

    .pill-select {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #f9f4f1;
      font-size: 0.78rem;
      color: var(--text-soft);
      outline: none;
    }

    h1 {
      text-align: center;
      margin: 4px 0 6px 0;
      font-size: 1.05rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--text-soft);
    }

    .subtitle {
      text-align: center;
      font-size: 0.86rem;
      color: var(--text-soft);
      margin-bottom: 16px;
      line-height: 1.4;
    }

    .card {
      background: var(--card);
      border-radius: 18px;
      box-shadow: 0 18px 45px rgba(0,0,0,0.06);
      overflow: hidden;
      border: 1px solid #e2d3c8;
    }

    .tracker {
      background: var(--card);
      display: block;
    }

    .header-ribbon {
      background: var(--primary);
      padding: 16px 16px 14px 16px;
      color: #fff;
    }

    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .header-text {
      flex: 1;
      min-width: 180px;
    }

    .surah-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      opacity: 0.8;
      margin-bottom: 5px;
    }

    .surah-name {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 3px;
    }

    .surah-ar {
      font-size: 1.1rem;
      font-weight: 600;
      direction: rtl;
      text-align: right;
    }

    .surah-meta {
      font-size: 0.75rem;
      opacity: 0.85;
      margin-top: 3px;
    }

    .selector {
      margin-top: 10px;
    }

    .selector label {
      display: block;
      font-size: 0.72rem;
      margin-bottom: 4px;
      opacity: 0.9;
    }

    .selector select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.7);
      background: rgba(255,255,255,0.16);
      color: #fff;
      font-size: 0.85rem;
      outline: none;
      backdrop-filter: blur(8px);
    }

    .selector select option {
      color: #222;
      background: #fff;
    }

    .body {
      padding: 14px 14px 18px 14px;
      background: radial-gradient(circle at top, #f4e7db, var(--bg));
    }

    .section-title {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-soft);
      text-align: center;
      margin: 8px 0 4px 0;
    }

    .section-sub {
      text-align: center;
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .bulk-actions {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 6px;
      flex-wrap: wrap;
    }

    .bulk-btn {
      font-size: 0.72rem;
      padding: 4px 14px;
      border-radius: 999px;
      border: 1px solid var(--primary);
      background: #fff;
      cursor: pointer;
      color: var(--text-soft);
      transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease;
    }

    .bulk-btn.secondary {
      border-color: var(--border-soft);
      color: var(--text-muted);
    }

    .bulk-btn:hover {
      background: var(--primary-soft);
      color: var(--text-main);
    }

    .grid-wrapper {
      background: var(--primary-soft);
      border-radius: 12px;
      border: 1px solid var(--border-soft);
      padding: 10px;
      margin-bottom: 14px;
    }

    .verse-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(26px, 1fr));
      gap: 4px;
    }

    .verse {
      font-size: 0.7rem;
      text-align: center;
      padding: 4px 0;
      border-radius: 8px;
      border: 1px solid var(--border-soft);
      background: #fff;
      cursor: pointer;
      user-select: none;
      transition: background 0.15s ease, color 0.15s ease,
                  transform 0.12s ease, box-shadow 0.12s ease, border-color 0.15s ease;
    }

    .verse:active {
      transform: scale(0.94);
    }

    .verse.mem-on {
      background: var(--mem-color);
      color: #fff;
      border-color: var(--mem-color);
      box-shadow: 0 0 0 1px rgba(0,0,0,0.03);
      font-weight: 600;
    }

    .verse.rev-on {
      background: var(--rev-bg);
      border-color: var(--rev-color);
      box-shadow: 0 0 0 1px rgba(111,123,112,0.35);
      color: var(--rev-color);
      font-weight: 600;
    }

    .legend {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-top: 6px;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .legend-dot {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
    }

    .legend-dot.mem {
      background: var(--mem-color);
      border-color: var(--mem-color);
    }

    .legend-dot.rev {
      background: var(--rev-bg);
      border-color: var(--rev-color);
    }

    .progress {
      margin-top: 10px;
      font-size: 0.72rem;
      color: var(--text-soft);
      text-align: center;
    }

    .global-stats {
      margin-top: 6px;
      font-size: 0.7rem;
      color: var(--text-muted);
      text-align: center;
      line-height: 1.4;
    }

    /* --- Section Juz --- */
    .juz-section {
      margin-top: 16px;
    }

    .juz-card {
      margin-top: 6px;
      background: var(--card);
      border-radius: 14px;
      border: 1px solid var(--border-soft);
      padding: 10px 12px 12px;
    }

    .juz-current {
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-bottom: 8px;
    }

    .juz-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 6px;
    }

    .juz-btn {
      font-size: 0.72rem;
      padding: 4px 12px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #fff;
      cursor: pointer;
      color: var(--text-soft);
      transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease;
    }

    .juz-btn.on {
      background: var(--primary-soft);
      border-color: var(--primary);
      color: var(--text-main);
      font-weight: 600;
    }

    .juz-progress {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .footer-note {
      font-size: 0.72rem;
      color: var(--text-muted);
      text-align: center;
      margin-top: 10px;
      line-height: 1.4;
    }

    .legal {
      margin-top: 10px;
      font-size: 0.68rem;
      color: var(--text-muted);
      text-align: center;
    }

    @media (min-width: 720px) {
      body { padding: 24px; }
      .body { padding: 18px 18px 22px 18px; }
      .verse-grid { gap: 5px; }
      .verse { font-size: 0.72rem; padding: 5px 0; }
    }
  </style>
</head>

<body data-theme="mocha">

  <!-- ÉCRAN D’ACTIVATION NOOTQA -->
  <div id="activation-screen" style="max-width: 840px; margin: 40px auto; font-family: inherit;">
    <div style="background:#ffffff; border-radius:18px; padding:20px 18px 24px; box-shadow:0 18px 45px rgba(0,0,0,0.06); border:1px solid #e2d3c8;">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:14px;">
        <div style="font-size:1.1rem; font-weight:600; color:#2b2320;">
          nootqa – Qur’an Tracker
        </div>
        <div style="font-size:0.8rem; color:#9b8f86;">
          Activation requise
        </div>
      </div>
      <p style="font-size:0.9rem; color:#6e625a; line-height:1.5; margin-bottom:14px;">
        Merci d’avoir choisi <strong>nootqa</strong>. Pour utiliser cette mini-application de suivi du ḥifdh et de la révision,
        entre ton <strong>code d’activation</strong> reçu après l’achat.
      </p>

      <label for="activation-code" style="display:block; font-size:0.8rem; color:#6e625a; margin-bottom:6px;">
        Code d’activation
      </label>
      <input
        id="activation-code"
        type="text"
        placeholder="NOOTQA-001"
        style="width:100%; padding:10px 12px; border-radius:999px; border:1px solid #d1c0b4; font-size:0.9rem; margin-bottom:10px; outline:none;"
      />

      <button
        id="activation-btn"
        style="width:100%; padding:10px 12px; border-radius:999px; border:none; background:#a1897b; color:#fff;
               font-size:0.9rem; font-weight:600; letter-spacing:0.08em; text-transform:uppercase; cursor:pointer;
               box-shadow:0 10px 22px rgba(0,0,0,0.15); margin-bottom:6px;">
        Activer mon accès
      </button>

      <div id="activation-message" style="font-size:0.8rem; color:#b34646; min-height:1em;"></div>

      <p style="font-size:0.75rem; color:#9b8f86; margin-top:10px; line-height:1.5;">
        Ce code est valable pour un <strong>usage personnel</strong> sur un appareil. Pour les packs famille ou classe,
        utilise un code par personne.
      </p>
    </div>
  </div>

  <!-- APP PRINCIPALE -->
  <div class="app">

    <!-- Basmala -->
    <div class="bismillah">
      بِسْمِ اللهِ الرَّحْمٰنِ الرَّحِيمِ
    </div>

    <!-- Barre du haut -->
    <div class="top-bar">
      <div class="brand" id="brandText">QUR'AN TRACKER</div>

      <div class="right-controls">
        <div class="control-row">
          <span class="control-label" id="langLabel">LANGUE</span>
          <select id="langSelect" class="pill-select">
            <option value="fr">Français</option>
            <option value="en">English</option>
          </select>
        </div>
        <div class="control-row">
          <span class="control-label" id="themeLabel">THÈME</span>
          <select id="themeSelect" class="pill-select">
            <option value="mocha">Mocha</option>
            <option value="rose">Rose nude</option>
          </select>
        </div>
        <div class="control-row">
          <span class="control-label" id="juzLabel">JUZ</span>
          <select id="juzSelect" class="pill-select">
            <option value="none">Aucun</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Titre / sous-titre -->
    <h1 id="mainTitle">QUR'AN TRACKER – HIFDH &amp; RÉVISION</h1>
    <div class="subtitle" id="subtitleText">
      Une mini-application pour suivre ta mémorisation et ta révision du Qur'an.
    </div>

    <!-- Carte principale sourates -->
    <div class="card">
      <div class="tracker" id="tracker">
        <div class="header-ribbon">
          <div class="header-top">
            <div class="header-text">
              <div class="surah-label" id="currentSurahLabel">Sourate actuelle</div>
              <div class="surah-name" id="surahLatin">1. Al-Fatiha</div>
              <div class="surah-meta" id="surahMeta">7 versets</div>
            </div>
            <div class="surah-ar" id="surahArabic">سورة الفاتحة</div>
          </div>

          <div class="selector">
            <label for="surahSelect" id="surahSelectLabel">Choisir une sourate :</label>
            <select id="surahSelect"></select>
          </div>
        </div>

        <div class="body">

          <!-- Mémorisation -->
          <div class="section">
            <div class="section-title" id="memTitle">Mémorisation (ḥifdh)</div>
            <div class="section-sub" id="memSub">Clique sur les versets mémorisés.</div>

            <div class="bulk-actions">
              <button class="bulk-btn" id="memSelectAll">Tout sélectionner</button>
              <button class="bulk-btn secondary" id="memClearAll">Tout effacer</button>
            </div>

            <div class="grid-wrapper">
              <div id="gridMem" class="verse-grid"></div>
              <div class="legend">
                <div class="legend-item">
                  <div class="legend-dot mem"></div>
                  <span id="legendMem">Mémorisé</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Révision -->
          <div class="section">
            <div class="section-title" id="revTitle">Révision (mourājaʿa)</div>
            <div class="section-sub" id="revSub">Clique sur les versets révisés.</div>

            <div class="bulk-actions">
              <button class="bulk-btn" id="revSelectAll">Tout sélectionner</button>
              <button class="bulk-btn secondary" id="revClearAll">Tout effacer</button>
            </div>

            <div class="grid-wrapper">
              <div id="gridRev" class="verse-grid"></div>
              <div class="legend">
                <div class="legend-item">
                  <div class="legend-dot rev"></div>
                  <span id="legendRev">Révisé</span>
                </div>
              </div>
            </div>
          </div>

          <div class="progress" id="progressText">
            0 mémorisé · 0 révisé
          </div>

          <div class="global-stats" id="globalStats">
            Sourates totalement mémorisées : 0 / 114 · sourates totalement révisées : 0 / 114.
          </div>

          <!-- Section Juz -->
          <div class="juz-section">
            <div class="section-title" id="juzSectionTitle">Lecture par juz</div>
            <div class="section-sub" id="juzSectionSub">
              Choisis un juz dans le menu en haut, puis marque-le mémorisé ou révisé.
            </div>
            <div class="juz-card">
              <div class="juz-current" id="juzCurrentLabel">
                Aucun juz sélectionné.
              </div>
              <div class="juz-actions">
                <button class="juz-btn" id="juzMemBtn">Marquer mémorisé</button>
                <button class="juz-btn" id="juzRevBtn">Marquer révisé</button>
              </div>
              <div class="juz-progress" id="juzProgressText">
                Juz mémorisés : 0 / 30 · Juz révisés : 0 / 30.
              </div>
            </div>
          </div>

          <div class="footer-note" id="footerNote">
            Une interface simple pour te concentrer sur l'essentiel : ton Qur'an.
          </div>

        </div>
      </div>
    </div>

    <div class="legal">
      ©️ 2025 Nootqa. Usage personnel uniquement — reproduction et partage du code interdits.
    </div>
  </div>

  <script>
    /* --------- Données sourates --------- */
    const SURAH_DATA = [
      { n: 1, latin: "Al-Fatiha", arabic: "الفاتحة", verses: 7 },
      { n: 2, latin: "Al-Baqara", arabic: "البقرة", verses: 286 },
      { n: 3, latin: "Aal Imran", arabic: "آل عمران", verses: 200 },
      { n: 4, latin: "An-Nisa", arabic: "النساء", verses: 176 },
      { n: 5, latin: "Al-Ma'idah", arabic: "المائدة", verses: 120 },
      { n: 6, latin: "Al-An'am", arabic: "الأنعام", verses: 165 },
      { n: 7, latin: "Al-A'raf", arabic: "الأعراف", verses: 206 },
      { n: 8, latin: "Al-Anfal", arabic: "الأنفال", verses: 75 },
      { n: 9, latin: "At-Tawbah", arabic: "التوبة", verses: 129 },
      { n: 10, latin: "Yunus", arabic: "يونس", verses: 109 },
      { n: 11, latin: "Hud", arabic: "هود", verses: 123 },
      { n: 12, latin: "Yusuf", arabic: "يوسف", verses: 111 },
      { n: 13, latin: "Ar-Ra'd", arabic: "الرعد", verses: 43 },
      { n: 14, latin: "Ibrahim", arabic: "إبراهيم", verses: 52 },
      { n: 15, latin: "Al-Hijr", arabic: "الحجر", verses: 99 },
      { n: 16, latin: "An-Nahl", arabic: "النحل", verses: 128 },
      { n: 17, latin: "Al-Isra", arabic: "الإسراء", verses: 111 },
      { n: 18, latin: "Al-Kahf", arabic: "الكهف", verses: 110 },
      { n: 19, latin: "Maryam", arabic: "مريم", verses: 98 },
      { n: 20, latin: "Ta-Ha", arabic: "طه", verses: 135 },
      { n: 21, latin: "Al-Anbiya", arabic: "الأنبياء", verses: 112 },
      { n: 22, latin: "Al-Hajj", arabic: "الحج", verses: 78 },
      { n: 23, latin: "Al-Mu'minun", arabic: "المؤمنون", verses: 118 },
      { n: 24, latin: "An-Nur", arabic: "النور", verses: 64 },
      { n: 25, latin: "Al-Furqan", arabic: "الفرقان", verses: 77 },
      { n: 26, latin: "Ash-Shu'ara", arabic: "الشعراء", verses: 227 },
      { n: 27, latin: "An-Naml", arabic: "النمل", verses: 93 },
      { n: 28, latin: "Al-Qasas", arabic: "القصص", verses: 88 },
      { n: 29, latin: "Al-Ankabut", arabic: "العنكبوت", verses: 69 },
      { n: 30, latin: "Ar-Rum", arabic: "الروم", verses: 60 },
      { n: 31, latin: "Luqman", arabic: "لقمان", verses: 34 },
      { n: 32, latin: "As-Sajda", arabic: "السجدة", verses: 30 },
      { n: 33, latin: "Al-Ahzab", arabic: "الأحزاب", verses: 73 },
      { n: 34, latin: "Saba", arabic: "سبأ", verses: 54 },
      { n: 35, latin: "Fatir", arabic: "فاطر", verses: 45 },
      { n: 36, latin: "Ya-Sin", arabic: "يس", verses: 83 },
      { n: 37, latin: "As-Saffat", arabic: "الصافات", verses: 182 },
      { n: 38, latin: "Sad", arabic: "ص", verses: 88 },
      { n: 39, latin: "Az-Zumar", arabic: "الزمر", verses: 75 },
      { n: 40, latin: "Ghafir", arabic: "غافر", verses: 85 },
      { n: 41, latin: "Fussilat", arabic: "فصلت", verses: 54 },
      { n: 42, latin: "Ash-Shura", arabic: "الشورى", verses: 53 },
      { n: 43, latin: "Az-Zukhruf", arabic: "الزخرف", verses: 89 },
      { n: 44, latin: "Ad-Dukhan", arabic: "الدخان", verses: 59 },
      { n: 45, latin: "Al-Jathiyah", arabic: "الجاثية", verses: 37 },
      { n: 46, latin: "Al-Ahqaf", arabic: "الأحقاف", verses: 35 },
      { n: 47, latin: "Muhammad", arabic: "محمد", verses: 38 },
      { n: 48, latin: "Al-Fath", arabic: "الفتح", verses: 29 },
      { n: 49, latin: "Al-Hujurat", arabic: "الحجرات", verses: 18 },
      { n: 50, latin: "Qaf", arabic: "ق", verses: 45 },
      { n: 51, latin: "Adh-Dhariyat", arabic: "الذاريات", verses: 60 },
      { n: 52, latin: "At-Tur", arabic: "الطور", verses: 49 },
      { n: 53, latin: "An-Najm", arabic: "النجم", verses: 62 },
      { n: 54, latin: "Al-Qamar", arabic: "القمر", verses: 55 },
      { n: 55, latin: "Ar-Rahman", arabic: "الرحمن", verses: 78 },
      { n: 56, latin: "Al-Waqi'ah", arabic: "الواقعة", verses: 96 },
      { n: 57, latin: "Al-Hadid", arabic: "الحديد", verses: 29 },
      { n: 58, latin: "Al-Mujadila", arabic: "المجادلة", verses: 22 },
      { n: 59, latin: "Al-Hashr", arabic: "الحشر", verses: 24 },
      { n: 60, latin: "Al-Mumtahanah", arabic: "الممتحنة", verses: 13 },
      { n: 61, latin: "As-Saff", arabic: "الصف", verses: 14 },
      { n: 62, latin: "Al-Jumu'ah", arabic: "الجمعة", verses: 11 },
      { n: 63, latin: "Al-Munafiqun", arabic: "المنافقون", verses: 11 },
      { n: 64, latin: "At-Taghabun", arabic: "التغابن", verses: 18 },
      { n: 65, latin: "At-Talaq", arabic: "الطلاق", verses: 12 },
      { n: 66, latin: "At-Tahrim", arabic: "التحريم", verses: 12 },
      { n: 67, latin: "Al-Mulk", arabic: "الملك", verses: 30 },
      { n: 68, latin: "Al-Qalam", arabic: "القلم", verses: 52 },
      { n: 69, latin: "Al-Haqqah", arabic: "الحاقة", verses: 52 },
      { n: 70, latin: "Al-Ma'arij", arabic: "المعارج", verses: 44 },
      { n: 71, latin: "Nuh", arabic: "نوح", verses: 28 },
      { n: 72, latin: "Al-Jinn", arabic: "الجن", verses: 28 },
      { n: 73, latin: "Al-Muzzammil", arabic: "المزمل", verses: 20 },
      { n: 74, latin: "Al-Muddaththir", arabic: "المدثر", verses: 56 },
      { n: 75, latin: "Al-Qiyamah", arabic: "القيامة", verses: 40 },
      { n: 76, latin: "Al-Insan", arabic: "الإنسان", verses: 31 },
      { n: 77, latin: "Al-Mursalat", arabic: "المرسلات", verses: 50 },
      { n: 78, latin: "An-Naba", arabic: "النبأ", verses: 40 },
      { n: 79, latin: "An-Nazi'at", arabic: "النازعات", verses: 46 },
      { n: 80, latin: "Abasa", arabic: "عبس", verses: 42 },
      { n: 81, latin: "At-Takwir", arabic: "التكوير", verses: 29 },
      { n: 82, latin: "Al-Infitar", arabic: "الإنفطار", verses: 19 },
      { n: 83, latin: "Al-Mutaffifin", arabic: "المطففين", verses: 36 },
      { n: 84, latin: "Al-Inshiqaq", arabic: "الإنشقاق", verses: 25 },
      { n: 85, latin: "Al-Buruj", arabic: "البروج", verses: 22 },
      { n: 86, latin: "At-Tariq", arabic: "الطارق", verses: 17 },
      { n: 87, latin: "Al-A'la", arabic: "الأعلى", verses: 19 },
      { n: 88, latin: "Al-Ghashiyah", arabic: "الغاشية", verses: 26 },
      { n: 89, latin: "Al-Fajr", arabic: "الفجر", verses: 30 },
      { n: 90, latin: "Al-Balad", arabic: "البلد", verses: 20 },
      { n: 91, latin: "Ash-Shams", arabic: "الشمس", verses: 15 },
      { n: 92, latin: "Al-Layl", arabic: "الليل", verses: 21 },
      { n: 93, latin: "Ad-Duha", arabic: "الضحى", verses: 11 },
      { n: 94, latin: "Ash-Sharh", arabic: "الشرح", verses: 8 },
      { n: 95, latin: "At-Tin", arabic: "التين", verses: 8 },
      { n: 96, latin: "Al-Alaq", arabic: "العلق", verses: 19 },
      { n: 97, latin: "Al-Qadr", arabic: "القدر", verses: 5 },
      { n: 98, latin: "Al-Bayyinah", arabic: "البينة", verses: 8 },
      { n: 99, latin: "Az-Zalzalah", arabic: "الزلزلة", verses: 8 },
      { n: 100, latin: "Al-Adiyat", arabic: "العاديات", verses: 11 },
      { n: 101, latin: "Al-Qari'ah", arabic: "القارعة", verses: 11 },
      { n: 102, latin: "At-Takathur", arabic: "التكاثر", verses: 8 },
      { n: 103, latin: "Al-Asr", arabic: "العصر", verses: 3 },
      { n: 104, latin: "Al-Humazah", arabic: "الهمزة", verses: 9 },
      { n: 105, latin: "Al-Fil", arabic: "الفيل", verses: 5 },
      { n: 106, latin: "Quraysh", arabic: "قريش", verses: 4 },
      { n: 107, latin: "Al-Ma'un", arabic: "الماعون", verses: 7 },
      { n: 108, latin: "Al-Kawthar", arabic: "الكوثر", verses: 3 },
      { n: 109, latin: "Al-Kafirun", arabic: "الكافرون", verses: 6 },
      { n: 110, latin: "An-Nasr", arabic: "النصر", verses: 3 },
      { n: 111, latin: "Al-Masad", arabic: "المسد", verses: 5 },
      { n: 112, latin: "Al-Ikhlas", arabic: "الإخلاص", verses: 4 },
      { n: 113, latin: "Al-Falaq", arabic: "الفلق", verses: 5 },
      { n: 114, latin: "An-Nas", arabic: "الناس", verses: 6 }
    ];

    /* --------- Liste des 30 Juz (nom simple) --------- */
    const JUZ_LIST = Array.from({ length: 30 }, (_, i) => ({
      id: i + 1,
      label: `Juz ${i + 1}`
    }));

    /* --------- Textes FR / EN --------- */
    const STRINGS = {
      fr: {
        brand: "QUR'AN TRACKER",
        langLabel: "LANGUE",
        themeLabel: "THÈME",
        mainTitle: "QUR'AN TRACKER – HIFDH & RÉVISION",
        subtitle: "Une mini-application pour suivre ta mémorisation et ta révision du Qur'an.",
        currentSurahLabel: "Sourate actuelle",
        surahSelectLabel: "Choisir une sourate :",
        memTitle: "Mémorisation (ḥifdh)",
        memSub: "Clique sur les versets mémorisés.",
        revTitle: "Révision (mourājaʿa)",
        revSub: "Clique sur les versets révisés.",
        legendMem: "Mémorisé",
        legendRev: "Révisé",
        memSelectAll: "Tout sélectionner",
        memClearAll: "Tout effacer",
        revSelectAll: "Tout sélectionner",
        revClearAll: "Tout effacer",
        footerNote: "Une interface simple pour te concentrer sur l'essentiel : ton Qur'an.",
        progress(mem, rev) {
          return `${mem} mémorisé · ${rev} révisé`;
        },
        globalSummary(fullMem, fullRev) {
          return `Sourates totalement mémorisées : ${fullMem} / 114 · sourates totalement révisées : ${fullRev} / 114.`;
        },
        // Juz
        juzLabel: "Juz",
        juzSectionTitle: "Lecture par juz",
        juzSectionSub: "Choisis un juz dans le menu en haut, puis marque-le mémorisé ou révisé.",
        juzNoneSelected: "Aucun juz sélectionné.",
        juzCurrent(j) {
          return `Juz ${j}`;
        },
        juzMemBtn: "Marquer mémorisé",
        juzRevBtn: "Marquer révisé",
        juzProgress(memCount, revCount) {
          return `Juz mémorisés : ${memCount} / 30 · Juz révisés : ${revCount} / 30.`;
        }
      },
      en: {
        brand: "QUR'AN TRACKER",
        langLabel: "LANG",
        themeLabel: "THEME",
        mainTitle: "QUR'AN TRACKER – HIFDH & REVISION",
        subtitle: "A simple mini-app to track your Qur'an memorisation and revision.",
        currentSurahLabel: "Current surah",
        surahSelectLabel: "Choose a surah:",
        memTitle: "Memorisation (ḥifdh)",
        memSub: "Tap the verses you have memorised.",
        revTitle: "Revision (murāja'ah)",
        revSub: "Tap the verses you have revised.",
        legendMem: "Memorised",
        legendRev: "Revised",
        memSelectAll: "Select all",
        memClearAll: "Clear all",
        revSelectAll: "Select all",
        revClearAll: "Clear all",
        footerNote: "A minimal interface to help you stay consistent with your Qur'an.",
        progress(mem, rev) {
          const m = mem === 1 ? "verse" : "verses";
          const r = rev === 1 ? "verse" : "verses";
          return `${mem} ${m} memorised · ${rev} ${r} revised`;
        },
        globalSummary(fullMem, fullRev) {
          return `Fully memorised surahs: ${fullMem} / 114 · fully revised surahs: ${fullRev} / 114.`;
        },
        // Juz
        juzLabel: "Juz",
        juzSectionTitle: "Reading by juz",
        juzSectionSub: "Choose a juz in the top menu, then mark it memorised or revised.",
        juzNoneSelected: "No juz selected.",
        juzCurrent(j) {
          return `Juz ${j}`;
        },
        juzMemBtn: "Mark memorised",
        juzRevBtn: "Mark revised",
        juzProgress(memCount, revCount) {
          return `Juz memorised: ${memCount} / 30 · Juz revised: ${revCount} / 30.`;
        }
      }
    };

    const el = id => document.getElementById(id);

    const langSelect = el("langSelect");
    const themeSelect = el("themeSelect");
    const brandText = el("brandText");
    const langLabel = el("langLabel");
    const themeLabel = el("themeLabel");
    const mainTitle = el("mainTitle");
    const subtitleText = el("subtitleText");
    const currentSurahLabel = el("currentSurahLabel");
    const surahSelectLabel = el("surahSelectLabel");
    const memTitle = el("memTitle");
    const memSub = el("memSub");
    const revTitle = el("revTitle");
    const revSub = el("revSub");
    const legendMem = el("legendMem");
    const legendRev = el("legendRev");
    const footerNote = el("footerNote");
    const progressText = el("progressText");
    const globalStats = el("globalStats");

    const memSelectAllBtn = el("memSelectAll");
    const memClearAllBtn = el("memClearAll");
    const revSelectAllBtn = el("revSelectAll");
    const revClearAllBtn = el("revClearAll");

    const surahSelect = el("surahSelect");
    const surahLatin = el("surahLatin");
    const surahArabic = el("surahArabic");
    const surahMeta = el("surahMeta");
    const gridMem = el("gridMem");
    const gridRev = el("gridRev");

    // Juz DOM
    const juzLabel = el("juzLabel");
    const juzSelect = el("juzSelect");
    const juzSectionTitle = el("juzSectionTitle");
    const juzSectionSub = el("juzSectionSub");
    const juzCurrentLabel = el("juzCurrentLabel");
    const juzMemBtn = el("juzMemBtn");
    const juzRevBtn = el("juzRevBtn");
    const juzProgressText = el("juzProgressText");

    // Activation
    const activationScreen = document.getElementById("activation-screen");
    const activationInput  = document.getElementById("activation-code");
    const activationBtn    = document.getElementById("activation-btn");
    const activationMsg    = document.getElementById("activation-message");
    const appContainer     = document.querySelector(".app");

    // Codes d’activation valides
    const VALID_CODES = [
      "NOOTQA-001"
    ];

    function showApp() {
      if (activationScreen) activationScreen.style.display = "none";
      if (appContainer) appContainer.style.display = "block";
    }

    function isAlreadyActivated() {
      return localStorage.getItem("nootqa_activated") === "1";
    }

    if (isAlreadyActivated()) {
      showApp();
    }

    if (activationBtn) {
      activationBtn.addEventListener("click", () => {
        const code = (activationInput.value || "").trim().toUpperCase();

        if (!code) {
          activationMsg.textContent = "Merci d’entrer un code.";
          activationMsg.style.color = "#b34646";
          return;
        }

        if (!VALID_CODES.includes(code)) {
          activationMsg.textContent = "Code invalide. Vérifie les majuscules et les tirets.";
          activationMsg.style.color = "#b34646";
          return;
        }

        // Code accepté → on enregistre l’activation sur cet appareil
        localStorage.setItem("nootqa_activated", "1");
        localStorage.setItem("nootqa_activation_code", code);

        activationMsg.style.color = "#2f7c4a";
        activationMsg.textContent = "Code accepté, ouverture de l’application…";
        setTimeout(showApp, 400);
      });
    }

    /* ------ Changement de langue ------ */
    function applyLanguage(lang) {
      const S = STRINGS[lang] || STRINGS.fr;
      document.documentElement.lang = lang;
      document.body.dir = "ltr"; // layout général LTR

      brandText.textContent = S.brand;
      langLabel.textContent = S.langLabel;
      themeLabel.textContent = S.themeLabel;
      mainTitle.textContent = S.mainTitle;
      subtitleText.textContent = S.subtitle;
      currentSurahLabel.textContent = S.currentSurahLabel;
      surahSelectLabel.textContent = S.surahSelectLabel;
      memTitle.textContent = S.memTitle;
      memSub.textContent = S.memSub;
      revTitle.textContent = S.revTitle;
      revSub.textContent = S.revSub;
      legendMem.textContent = S.legendMem;
      legendRev.textContent = S.legendRev;
      memSelectAllBtn.textContent = S.memSelectAll;
      memClearAllBtn.textContent = S.memClearAll;
      revSelectAllBtn.textContent = S.revSelectAll;
      revClearAllBtn.textContent = S.revClearAll;
      footerNote.textContent = S.footerNote;

      // Juz
      juzLabel.textContent = S.juzLabel;
      juzSectionTitle.textContent = S.juzSectionTitle;
      juzSectionSub.textContent = S.juzSectionSub;
      juzMemBtn.textContent = S.juzMemBtn;
      juzRevBtn.textContent = S.juzRevBtn;

      updateProgress();
      updateGlobalStats();
      updateJuzUI();
      updateJuzProgress();

      localStorage.setItem("nootqa_lang", lang);
    }

    langSelect.addEventListener("change", () => {
      applyLanguage(langSelect.value);
    });

    /* ------ Thèmes ------ */
    function applyTheme(theme) {
      document.body.setAttribute("data-theme", theme);
      localStorage.setItem("nootqa_theme", theme);
    }

    themeSelect.addEventListener("change", () => {
      applyTheme(themeSelect.value);
    });

    /* ------ Surates ------ */
    SURAH_DATA.forEach(s => {
      const opt = document.createElement("option");
      opt.value = s.n;
      opt.textContent = `${s.n}. ${s.latin}`;
      surahSelect.appendChild(opt);
    });

    function key(type, surah, verse) {
      return `nootqa_${type}_${surah}_${verse}`;
    }

    function buildSurah(num) {
      const s = SURAH_DATA.find(x => x.n == num);
      if (!s) return;

      surahLatin.textContent = `${s.n}. ${s.latin}`;
      surahArabic.textContent = "سورة " + s.arabic;
      surahMeta.textContent = `${s.verses} versets`;

      gridMem.innerHTML = "";
      gridRev.innerHTML = "";

      for (let v = 1; v <= s.verses; v++) {
        const mem = document.createElement("div");
        mem.className = "verse";
        mem.textContent = v;
        mem.addEventListener("click", () => toggle("mem", s.n, v, mem));
        gridMem.appendChild(mem);

        const rev = document.createElement("div");
        rev.className = "verse";
        rev.textContent = v;
        rev.addEventListener("click", () => toggle("rev", s.n, v, rev));
        gridRev.appendChild(rev);
      }

      restoreState(s.n);
      updateProgress();
    }

    function toggle(type, surahNum, verseNum, elVerse) {
      const k = key(type, surahNum, verseNum);
      const active = localStorage.getItem(k);
      const cls = type === "mem" ? "mem-on" : "rev-on";

      if (active) {
        localStorage.removeItem(k);
        elVerse.classList.remove(cls);
      } else {
        localStorage.setItem(k, "1");
        elVerse.classList.add(cls);
      }
      updateProgress();
    }

    function restoreState(surahNum) {
      const s = SURAH_DATA.find(x => x.n == surahNum);
      if (!s) return;

      for (let v = 1; v <= s.verses; v++) {
        const memKey = key("mem", surahNum, v);
        const revKey = key("rev", surahNum, v);
        const memElem = gridMem.children[v - 1];
        const revElem = gridRev.children[v - 1];

        if (localStorage.getItem(memKey)) {
          memElem.classList.add("mem-on");
        }
        if (localStorage.getItem(revKey)) {
          revElem.classList.add("rev-on");
        }
      }
    }

    function updateProgress() {
      const surahNum = parseInt(surahSelect.value || "1", 10);
      const s = SURAH_DATA.find(x => x.n == surahNum);
      if (!s) return;

      let mem = 0, rev = 0;
      for (let v = 1; v <= s.verses; v++) {
        if (localStorage.getItem(key("mem", surahNum, v))) mem++;
        if (localStorage.getItem(key("rev", surahNum, v))) rev++;
      }

      const lang = langSelect.value || "fr";
      const S = STRINGS[lang] || STRINGS.fr;
      progressText.textContent = S.progress(mem, rev);

      updateGlobalStats();
    }

    /* ------ Statistiques globales (sourates) ------ */
    function updateGlobalStats() {
      let fullMem = 0;
      let fullRev = 0;

      for (const s of SURAH_DATA) {
        let memCount = 0;
        let revCount = 0;
        for (let v = 1; v <= s.verses; v++) {
          if (localStorage.getItem(key("mem", s.n, v))) memCount++;
          if (localStorage.getItem(key("rev", s.n, v))) revCount++;
        }
        if (memCount === s.verses) fullMem++;
        if (revCount === s.verses) fullRev++;
      }

      const lang = langSelect.value || "fr";
      const S = STRINGS[lang] || STRINGS.fr;
      globalStats.textContent = S.globalSummary(fullMem, fullRev);
    }

    /* ------ Sélection globale versets ------ */
    function bulkToggle(type, on) {
      const surahNum = parseInt(surahSelect.value || "1", 10);
      const s = SURAH_DATA.find(x => x.n == surahNum);
      if (!s) return;

      const grid = type === "mem" ? gridMem : gridRev;
      const cls = type === "mem" ? "mem-on" : "rev-on";

      for (let v = 1; v <= s.verses; v++) {
        const k = key(type, surahNum, v);
        const cell = grid.children[v - 1];
        if (on) {
          localStorage.setItem(k, "1");
          cell.classList.add(cls);
        } else {
          localStorage.removeItem(k);
          cell.classList.remove(cls);
        }
      }
      updateProgress();
    }

    memSelectAllBtn.addEventListener("click", () => bulkToggle("mem", true));
    memClearAllBtn.addEventListener("click", () => bulkToggle("mem", false));
    revSelectAllBtn.addEventListener("click", () => bulkToggle("rev", true));
    revClearAllBtn.addEventListener("click", () => bulkToggle("rev", false));

    /* ---------- JUZ : stockage et UI ---------- */
    function juzKey(type, juzId) {
      return `nootqa_juz_${type}_${juzId}`;
    }

    function initJuzSelect() {
      // on garde l’option "none" existante
      JUZ_LIST.forEach(j => {
        const opt = document.createElement("option");
        opt.value = String(j.id);
        opt.textContent = j.label;
        juzSelect.appendChild(opt);
      });

      const savedJuz = localStorage.getItem("nootqa_juz_selected") || "none";
      juzSelect.value = savedJuz;
    }

    function updateJuzUI() {
      const lang = langSelect.value || "fr";
      const S = STRINGS[lang] || STRINGS.fr;

      const val = juzSelect.value;
      if (val === "none") {
        juzCurrentLabel.textContent = S.juzNoneSelected;
        juzMemBtn.classList.remove("on");
        juzRevBtn.classList.remove("on");
        return;
      }

      const j = parseInt(val, 10);
      juzCurrentLabel.textContent = S.juzCurrent(j);

      const memOn = !!localStorage.getItem(juzKey("mem", j));
      const revOn = !!localStorage.getItem(juzKey("rev", j));

      if (memOn) juzMemBtn.classList.add("on");
      else juzMemBtn.classList.remove("on");

      if (revOn) juzRevBtn.classList.add("on");
      else juzRevBtn.classList.remove("on");
    }

    function updateJuzProgress() {
      let memCount = 0;
      let revCount = 0;

      for (const j of JUZ_LIST) {
        if (localStorage.getItem(juzKey("mem", j.id))) memCount++;
        if (localStorage.getItem(juzKey("rev", j.id))) revCount++;
      }

      const lang = langSelect.value || "fr";
      const S = STRINGS[lang] || STRINGS.fr;
      juzProgressText.textContent = S.juzProgress(memCount, revCount);
    }

    juzSelect.addEventListener("change", () => {
      const val = juzSelect.value;
      localStorage.setItem("nootqa_juz_selected", val);
      updateJuzUI();
    });

    juzMemBtn.addEventListener("click", () => {
      const val = juzSelect.value;
      if (val === "none") return;
      const j = parseInt(val, 10);
      const k = juzKey("mem", j);
      if (localStorage.getItem(k)) {
        localStorage.removeItem(k);
      } else {
        localStorage.setItem(k, "1");
      }
      updateJuzUI();
      updateJuzProgress();
    });

    juzRevBtn.addEventListener("click", () => {
      const val = juzSelect.value;
      if (val === "none") return;
      const j = parseInt(val, 10);
      const k = juzKey("rev", j);
      if (localStorage.getItem(k)) {
        localStorage.removeItem(k);
      } else {
        localStorage.setItem(k, "1");
      }
      updateJuzUI();
      updateJuzProgress();
    });

    /* ------ Initialisation ------ */
    (function init() {
      const savedLang = localStorage.getItem("nootqa_lang") || "fr";
      langSelect.value = savedLang;

      const savedTheme = localStorage.getItem("nootqa_theme") || "mocha";
      themeSelect.value = savedTheme;
      applyTheme(savedTheme);

      initJuzSelect();
      applyLanguage(savedLang); // met aussi les textes Juz

      // Sourate par défaut = Al-Fâtiha (1)
      const savedSurah = parseInt(localStorage.getItem("nootqa_surah") || "1", 10);
      surahSelect.value = savedSurah;
      buildSurah(savedSurah);

      surahSelect.addEventListener("change", () => {
        const n = parseInt(surahSelect.value, 10);
        localStorage.setItem("nootqa_surah", n);
        buildSurah(n);
      });

      updateJuzUI();
      updateJuzProgress();
    })();
  </script>

  <!-- Service worker pour PWA -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').catch(err => {
          console.error('Service worker registration failed:', err);
        });
      });
    }
  </script>
</body>
</html>

